<template>
  <section class="about_wrap">
    <p ref="scrollText" class="scroll_text">Scroll</p>
    <!-- Intro / How I Work / Why This portfolio -->
    <article
      v-for="(article, i) in sections"
      :key="i"
      class="about_article container"
      :class="article.area"
    >
      <h2>{{ article.title }}</h2>
      <p v-html="article.text"></p>
    </article>
    <!-- Portfolio Structure -->
    <article ref="sectionRef" class="portfolio_structure container">
      <div class="inner">
        <h2 class="structure_title">Portfolio Structure</h2>
        <div class="stack_diagram">
          <!-- Stack Cards -->
          <div class="stack">
            <div v-for="(item, index) in stackItems" :key="index" class="stack_card">
              <strong class="label">
                {{ item.label }}
                <span v-if="item.api" class="api_badge">API</span>
              </strong>

              <p class="desc">{{ item.desc }}</p>
              <p class="desc">{{ item.subDesc }}</p>
              <span class="number">0{{ 1 + index }}</span>
              <a v-if="item.code" :href="item.code" target="_blank" class="code_link">
                View Code â†’
              </a>
            </div>
          </div>
        </div>
      </div>
    </article>
  </section>
  <section ref="endingText" class="mop_wrap container">
    <p class="ending_text">
      ì´ í¬íŠ¸í´ë¦¬ì˜¤ëŠ” ì™„ì„±ëœ ê²°ê³¼ë³´ë‹¤
      <strong>ì–´ë–¤ êµ¬ì¡°ë¡œ ë¬¸ì œë¥¼ í•´ì„í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë§Œë“¤ì—ˆëŠ”ì§€</strong>ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•œ
      ì‘ì—…ì…ë‹ˆë‹¤.<br /><br />

      í¼ë¸”ë¦¬ì…”ë¡œ ì‹œì‘í–ˆì§€ë§Œ, ì´ì œëŠ” í™”ë©´ ë’¤ì˜ êµ¬ì¡°ì™€ ë°ì´í„° íë¦„ê¹Œì§€ í•¨ê»˜ ì„¤ê³„í•  ìˆ˜ ìˆëŠ”
      í”„ë¡ íŠ¸ì—”ë“œë¡œ ì„±ì¥í•˜ê³ ì í•©ë‹ˆë‹¤.<br /><br />

      ì´ êµ¬ì¡°ëŠ” ì•ìœ¼ë¡œ ì‹¤ì œ API, ì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œë„ ê·¸ëŒ€ë¡œ í™•ì¥ë  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì´ ë©ë‹ˆë‹¤.<br /><br />

      ëê¹Œì§€ ë´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
    </p>
    <div class="copyright">&copy; 2026 jangyougnha</div>
  </section>
</template>

<script setup>
import { ref, onMounted } from 'vue';

const sections = [
  {
    area: 'intro',
    title: 'Intro',
    text: `
      í¼ë¸”ë¦¬ì…”ë¡œ ì‹œì‘í–ˆì§€ë§Œ,
      í™”ë©´ì„ ê·¸ë¦¬ëŠ” ê²ƒë³´ë‹¤ êµ¬ì¡°ë¥¼ ì„¤ê³„í•˜ëŠ” ê³¼ì •ì— ë” í¥ë¯¸ë¥¼ ëŠê»´ì™”ìŠµë‹ˆë‹¤.
      ì €ëŠ” ê²°ê³¼ë³´ë‹¤ ê·¸ ê²°ê³¼ê°€ ë§Œë“¤ì–´ì§€ëŠ” ê³¼ì •ê³¼ êµ¬ì¡°ë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê°í•©ë‹ˆë‹¤.
    `,
  },
  {
    area: 'how',
    title: 'How I Work',
    text: `
      ë””ìì¸ì„ ê·¸ëŒ€ë¡œ êµ¬í˜„í•˜ê¸°ë³´ë‹¤, í™”ë©´ì´ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ë¨¼ì € í•´ì„í•©ë‹ˆë‹¤.
      ë°˜ì‘í˜•, ë‹¤êµ­ì–´, ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•´ ì»´í¬ë„ŒíŠ¸ì™€ ë°ì´í„° êµ¬ì¡°ë¥¼ ë¨¼ì € ì •ë¦¬í•œ ë’¤ í™”ë©´ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
    `,
  },
  {
    area: 'purpose',
    title: 'Purpose Portfolio',
    text: `
      í”„ë¡œì íŠ¸ê°€ ëŠ˜ì–´ë‚˜ë”ë¼ë„ êµ¬ì¡°ë¥¼ ë°”ê¾¸ì§€ ì•Šê³ , ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ í™•ì¥í•  ìˆ˜ ìˆëŠ” í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ëª©í‘œë¡œ í–ˆìŠµë‹ˆë‹¤.
			ë‹¨ìˆœíˆ ë³´ì—¬ì£¼ê¸° ìœ„í•œ ê²°ê³¼ë¬¼ì´ ì•„ë‹ˆë¼, ì‹¤ì œ ì„œë¹„ìŠ¤ êµ¬ì¡°ë¥¼ ê°€ì •í•œ ì‘ì—…ë¬¼ì…ë‹ˆë‹¤.
    `,
  },
];

const stackItems = [
  {
    label: 'Excel / Raw Data',
    desc: 'í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ Excel ê¸°ë°˜ìœ¼ë¡œ ì •ë¦¬í•´ ë°ì´í„°ì˜ ê¸°ì¤€ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.',
    code: '/data/raw/projects.xlsx',
  },
  {
    label: 'JSON',
    desc: 'êµ¬ì¡°í™”ëœ í˜•íƒœë¡œ ë³€í™˜í•´ í™”ë©´ê³¼ ë¶„ë¦¬ëœ ë°ì´í„° ë ˆì´ì–´ë¥¼ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.',
    code: '/data/raw/projects.json',
  },
  {
    label: 'JavaScript Merge',
    desc: 'key ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³‘í•©í•´ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ ë‹¨ìœ„ë¡œ ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤.',
    subDesc: `**í˜„ì¬ëŠ” Excel ê¸°ë°˜ ì •ì  ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, 
		JavaScript ë³‘í•© ë‹¨ê³„ëŠ” API ì‘ë‹µìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤. 
		ì‹¤ì œ ì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œëŠ” ì´ ì§€ì ì— APIë¥¼ ì—°ê²°í•´ë„ í™”ë©´ êµ¬ì¡°ë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.`,
    code: '/data/projects.js',
    api: true,
  },
  {
    label: 'Dynamic Routing',
    desc: 'Nuxtì˜ ë™ì  ë¼ìš°íŒ…ì„ í™œìš©í•´ í”„ë¡œì íŠ¸ë³„ í˜ì´ì§€ë¥¼ ìë™ ìƒì„±í–ˆìŠµë‹ˆë‹¤.',
    code: '/pages/project/[name].vue',
  },
  {
    label: 'Reusable UI',
    desc: 'êµ¬ì¡°ëŠ” ìœ ì§€í•œ ì±„ ë°ì´í„°ë§Œ êµì²´í•´ í™•ì¥ ê°€ëŠ¥í•œ í™”ë©´ì„ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.',
    code: '/components/project/ProjectDetail.vue',
  },
];
const sectionRef = ref(null);
const scrollText = ref(null);
const endingText = ref(null);

let ctx = null;
let mm = null;
let mobileObserver = null;

const initMobileObserver = () => {
  const { $gsap } = useNuxtApp();

  const section = sectionRef.value;
  if (!section) return;

  const cards = section.querySelectorAll('.stack_card');
  if (!cards.length) return;

  // ì´ˆê¸° ìƒíƒœ
  $gsap.set(cards, {
    opacity: 0,
    y: 40,
    scale: 1,
  });

  mobileObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (!entry.isIntersecting) return;

        $gsap.to(entry.target, {
          opacity: 1,
          y: 0,
          duration: 0.6,
          ease: 'power2.out',
        });

        mobileObserver.unobserve(entry.target);
      });
    },
    {
      threshold: 0.25,
      rootMargin: '0px 0px -10% 0px',
    }
  );

  cards.forEach((card) => mobileObserver.observe(card));
};

const initDesktopScroll = () => {
  const { $gsap, $ScrollTrigger } = useNuxtApp();

  const section = sectionRef.value;
  if (!section) return;

  const cards = section.querySelectorAll('.stack_card');
  if (!cards.length) return;

  ctx = $gsap.context(() => {
    const cardHeight = cards[0].offsetHeight;
    const STACK_GAP = 40;
    const totalSteps = cards.length + 1;
    const CARD_SCROLL = (cardHeight + STACK_GAP) * totalSteps;

    // ì´ˆê¸° ìƒíƒœ
    $gsap.set(cards, {
      opacity: 0,
      y: (i) => i * STACK_GAP * 2,
      scale: 0.96,
    });

    const tl = $gsap.timeline({
      scrollTrigger: {
        trigger: section,
        start: 'top top',
        end: `+=${CARD_SCROLL}`,
        scrub: true,
        pin: true,
        invalidateOnRefresh: true,
        markers: false,

        onUpdate(self) {
          // ìŠ¤í¬ë¡¤ ì•ˆë‚´ í…ìŠ¤íŠ¸
          $gsap.set(scrollText.value, {
            autoAlpha: self.progress > 0.95 ? 0 : 1,
          });

          // ì—”ë”© í…ìŠ¤íŠ¸
          $gsap.set(endingText.value, {
            autoAlpha: self.progress > 0.1 ? 1 : 0,
          });
        },
      },
    });

    cards.forEach((card, index) => {
      tl.to(card, {
        opacity: 1,
        y: index * STACK_GAP,
        scale: 1,
        ease: 'power2.out',
      });

      if (index > 0) {
        tl.to(
          cards[index - 1],
          {
            scale: 0.9,
            ease: 'power2.out',
          },
          '<'
        );
      }
    });

    // ë§ˆì§€ë§‰ ì¹´ë“œ ì •ë¦¬
    tl.to(cards[cards.length - 1], {
      scale: 0.9,
      ease: 'power2.out',
    });
  }, section);

  $ScrollTrigger.refresh();
};
const initScrollAnimation = () => {
  if (!process.client) return;

  const { $ScrollTrigger } = useNuxtApp();

  $ScrollTrigger.matchMedia({
    // ğŸ–¥ Desktop
    '(min-width: 769px)': () => {
      initDesktopScroll();

      return () => {
        if (ctx) {
          ctx.revert();
          ctx = null;
        }
      };
    },

    // ğŸ“± Mobile
    '(max-width: 768px)': () => {
      initMobileObserver();

      return () => {
        if (mobileObserver) {
          mobileObserver.disconnect();
          mobileObserver = null;
        }
      };
    },
  });
};

onMounted(() => {
  nextTick(() => {
    initScrollAnimation();
  });
});

onUnmounted(() => {
  if (ctx) ctx.revert();
  if (mobileObserver) mobileObserver.disconnect();
});
</script>
<style lang="scss" scoped>
@use '@/assets/scss/abstracts/_mediaQuery.scss' as *;
.about_wrap {
  justify-content: flex-start;
  .scroll_text {
    display: none;
    position: fixed;
    left: 50%;
    bottom: 0%;
    transform: translateX(-50%);
    font-size: 20vw;
    mix-blend-mode: difference;
    z-index: 1;
    animation: sparkle 3s ease-in Infinite Alternate;
  }
  @keyframes sparkle {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  .about_article {
    height: fit-content;
    margin-bottom: 4rem;
    white-space: pre-line;
    p {
      line-height: 1.8;
    }
    h2 {
      font-size: clamp(1.4rem, 2vw, 1.6rem);
    }
    p,
    strong {
      font-size: clamp(1rem, 2vw, 1.4rem);
    }
  }
  $articles: (
    intro: intro,
    how: how,
    purpose: purpose,
  );
  @include media-breakpoint-up {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-areas: 'intro how purpose' 'structure structure structure' 'mop mop mop';
    gap: 4rem;
    .scroll_text {
      display: block;
    }
    .about_article {
      margin-bottom: 8rem;
      p {
        padding-left: 2rem;
        font-size: 1.4rem;
      }
    }
    @each $name, $area in $articles {
      .#{$name} {
        grid-area: $area;
      }
    }
  }
}

.portfolio_structure {
  position: relative;
  grid-area: structure;
  padding-top: 2rem;
  padding-bottom: 2rem;
  background: var(--background-inversion-color);
  .structure_title {
    color: var(--background-color);
  }
  .stack_diagram {
    position: relative;
    margin-top: 2rem;
    min-height: 40rem;
  }
  @include media-breakpoint-up {
    padding-top: 4rem;
    padding-bottom: 4rem;
    .stack_diagram {
      margin-top: 4rem;
    }
  }
}

.stack {
  position: relative;
  z-index: 1;
  .stack_card {
    width: 100%;
    min-height: 20rem;
    padding: 2rem;
    border-radius: 1.2rem;
    background: var(--color-bg, #fff);
    box-shadow: 0 1.2rem 4rem rgba(0, 0, 0, 0.12);
    font-size: 1.2rem;
    color: #303030;
    & + .stack_card {
      margin-top: 2rem;
    }
  }
  .label {
    display: flex;
    align-items: center;
    font-weight: 600;
  }

  .desc {
    margin-top: 0.75rem;
    margin-bottom: 2rem;
    line-height: 1.6;
  }
  .number {
    position: absolute;
    bottom: 2rem;
    right: 2rem;
    font-size: 4rem;
    opacity: 0.4;
  }
  .code_link {
    display: inline-block;
    margin-top: 1rem;
    color: #4f7cff;
    font-size: 1rem;
    text-decoration: underline;
  }
  @include media-breakpoint-up {
    .stack_card {
      position: absolute;
      top: 0;
      left: 0;
      & + .stack_card {
        margin-top: 0;
      }
    }
    .code_link {
      font-size: 1.2rem;
    }
  }
}

.api_badge {
  margin-left: 0.5rem;
  padding: 0.2rem 0.5rem;
  font-size: 0.7em;
  border-radius: 4px;
  background: #111;
  color: #fff;
}

.mop_wrap {
  padding-top: 4rem;
  padding-bottom: 4rem;
  grid-area: mop;
  transition: none;
  font-size: clamp(1rem, 2vw, 1.4rem);
  text-align: center;
  line-height: 1.6;
  .copyright {
    border-top: 1px solid var(--border-color);
    padding: 1rem 0;
    margin-top: 14rem;
  }
}
</style>
